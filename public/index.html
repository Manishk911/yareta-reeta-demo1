<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Reta — Uncovering what makes people exceptional (Demo)</title>
  <style>
    :root { --bg:#0b0f1a; --fg:#fff; --accent:#00ffd1; }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Roboto,Inter,Arial}
    main{
      min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;
      text-align:center;padding:3rem 1rem 220px;box-sizing:border-box
    }
    h1{font-size:1.5rem;margin:0}
    p{font-size:1rem;max-width:520px;line-height:1.5;margin:.75rem auto 0;opacity:.9}
    a.btn{
      display:inline-block;margin-top:1rem;background:var(--accent);color:#000;
      padding:.75rem 1.5rem;border-radius:10px;font-weight:700;text-decoration:none
    }

    /* Avatar bubble (left/bottom like your snippet) */
    #heygen-streaming-embed{
      z-index:9999;position:fixed;left:40px;bottom:40px;width:200px;height:200px;
      border-radius:50%;border:2px solid #fff;box-shadow:0 8px 24px rgba(0,0,0,.12);
      overflow:hidden;background:#000;cursor:pointer;
      transform-origin:bottom left;transform:scale(1);
      transition:transform .28s ease,opacity .2s ease,visibility .2s ease,border-radius .28s ease;
      opacity:0;visibility:hidden;
    }
    #heygen-streaming-embed.show{opacity:1;visibility:visible}

    /* Expanded state */
    #heygen-streaming-embed.expand{border:0;border-radius:8px}
    @media (max-width:539px){
      #heygen-streaming-embed.expand{height:266px;width:96%}
    }
    @media (min-width:540px){
      #heygen-streaming-embed.expand{height:366px;width:calc(366px * 16 / 9)}
    }

    /* Auto: speaking => 2x (kept for compatibility; may not trigger with LiveAvatar) */
    #heygen-streaming-embed.talking{transform:scale(2)}
    /* Manual: click => 3x */
    #heygen-streaming-embed.fullsize{transform:scale(3)}

    #heygen-streaming-container,#heygen-streaming-container iframe{
      width:100%;height:100%;display:block;border:0
    }
    @media (prefers-reduced-motion:reduce){#heygen-streaming-embed{transition:none}}
  </style>
</head>
<body>
  <main>
    <h1 id="title">Meet Reta — Uncovering what makes people exceptional</h1>
    <p>I’m Reta — I detect what makes you exceptional. Let’s start by building your profile in 3 quick questions.</p>
  </main>

  <!-- Optional: override content via URL params ?title= -->
  <script>
    (function(){
      const qs = new URLSearchParams(location.search);
      const t = qs.get('title');
      if (t) document.getElementById('title').textContent = t;
    })();
  </script>

  <!-- Embed + behavior (LiveAvatar) -->
  <script>
    (function () {
      // ✅ NEW LiveAvatar embed link
      const url = "https://embed.liveavatar.com/v1/e2330fb0-f644-4cf0-b841-98b3bd037224";

      // Wrapper + container
      const wrap = document.createElement("div");
      wrap.id = "heygen-streaming-embed";

      const container = document.createElement("div");
      container.id = "heygen-streaming-container";

      // Iframe (equivalent to: <iframe src="..." allow="microphone" title="LiveAvatar Embed" style="aspect-ratio:16/9;"></iframe>)
      const iframe = document.createElement("iframe");
      iframe.src = url;
      iframe.title = "LiveAvatar Embed";
      iframe.allow = "microphone; autoplay;";
      iframe.referrerPolicy = "origin-when-cross-origin";

      // Mount
      container.appendChild(iframe);
      wrap.appendChild(container);
      document.body.appendChild(wrap);

      // Reveal when loaded (so you always see the bubble)
      iframe.addEventListener("load", function(){ wrap.classList.add("show"); });

      // Expand when user interacts with the iframe (clicking mic inside iframe won't bubble to parent)
      iframe.addEventListener("focus", () => wrap.classList.add("expand"));
      iframe.addEventListener("blur",  () => wrap.classList.remove("expand"));

      // More robust: keep expanded while iframe is active (covers mobile quirks)
      setInterval(() => {
        wrap.classList.toggle("expand", document.activeElement === iframe);
      }, 200);

      // Click on the bubble wrapper (not inside iframe) → toggle 3x
      document.addEventListener("click", function (e) {
        const w = e.target && e.target.closest ? e.target.closest("#heygen-streaming-embed") : null;
        if (w) w.classList.toggle("fullsize");
      });

      // --- The blocks below are Heygen-specific. Safe to keep; likely won't trigger for LiveAvatar. ---

      // Handle Heygen init/show/hide events (no-op for LiveAvatar unless they send same messages)
      window.addEventListener("message", function (e) {
        if (e.source !== iframe.contentWindow) return;
        const d = e.data;
        if (d && d.type === "streaming-embed") {
          if (d.action === "init")  wrap.classList.add("show");
          if (d.action === "show")  wrap.classList.add("expand");
          if (d.action === "hide")  wrap.classList.remove("expand");
        }
      });

      // Auto 2x while speaking (no-op unless LiveAvatar sends similar events)
      (function enableTalkingScale(){
        let deb = null;
        function setTalk(v){ wrap.classList.toggle("talking", v); }
        window.addEventListener("message", function (e) {
          if (e.source !== iframe.contentWindow) return;
          let d = e.data;
          if (typeof d === "string") { try { d = JSON.parse(d); } catch {} }
          const raw = (d && (d.type || d.event || d.name || (d.detail && (d.detail.type || d.detail.event)))) || "";
          const t = String(raw).toUpperCase();

          const start = t === "AVATAR_START_TALKING" || t === "TALKING_START" || t === "AVATAR.TALKING_START" || raw === "avatar_start_talking";
          const stop  = t === "AVATAR_STOP_TALKING"  || t === "TALKING_END"   || t === "AVATAR.TALKING_STOP"  || raw === "avatar_stop_talking";
          const tick  = t === "AVATAR_TALKING_MESSAGE" || raw === "avatar_talking_message";

          if (start) setTalk(true);
          else if (stop) setTalk(false);
          else if (tick) { setTalk(true); clearTimeout(deb); deb = setTimeout(function(){ setTalk(false); }, 900); }
        });
      })();
    })();
  </script>
</body>
</html>
